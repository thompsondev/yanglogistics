<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YangLogistics Professional System Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        .test-section {
            padding: 30px;
            border-bottom: 1px solid #e5e7eb;
        }
        .test-section:last-child {
            border-bottom: none;
        }
        .test-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .test-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #3b82f6;
            margin-right: 12px;
            border-radius: 2px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .test-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }
        .test-card h3 {
            margin: 0 0 10px;
            color: #374151;
            font-size: 1.1rem;
        }
        .test-button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 5px;
        }
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .test-button.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .test-button.danger:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .test-button.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .test-button.warning:hover {
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .test-results {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .status-info { background: #3b82f6; }
        .form-test {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .summary {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .summary h3 {
            color: #0c4a6e;
            margin: 0 0 10px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #0c4a6e;
        }
        .stat-label {
            color: #0369a1;
            font-size: 0.9rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ YangLogistics Professional System Test</h1>
            <p>Comprehensive testing suite for Coolify deployment verification</p>
        </div>

        <div class="test-section">
            <div class="test-title">üîß System Configuration</div>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Environment Detection</h3>
                    <button class="test-button" onclick="testEnvironment()">Test Environment</button>
                    <div class="test-results" id="environment-results"></div>
                </div>
                <div class="test-card">
                    <h3>API Configuration</h3>
                    <button class="test-button" onclick="testAPIConfig()">Test API Config</button>
                    <div class="test-results" id="api-config-results"></div>
                </div>
                <div class="test-card">
                    <h3>Database Connection</h3>
                    <button class="test-button" onclick="testDatabase()">Test Database</button>
                    <div class="test-results" id="database-results"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üîê Authentication System</div>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Health Check</h3>
                    <button class="test-button" onclick="testHealthCheck()">Test Health</button>
                    <div class="test-results" id="health-results"></div>
                </div>
                <div class="test-card">
                    <h3>User Signup</h3>
                    <button class="test-button" onclick="testSignup()">Test Signup</button>
                    <div class="test-results" id="signup-results"></div>
                </div>
                <div class="test-card">
                    <h3>User Login</h3>
                    <button class="test-button" onclick="testLogin()">Test Login</button>
                    <div class="test-results" id="login-results"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üì¶ Order Management</div>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Create Order</h3>
                    <button class="test-button" onclick="testCreateOrder()">Test Create Order</button>
                    <div class="test-results" id="create-order-results"></div>
                </div>
                <div class="test-card">
                    <h3>Track Order</h3>
                    <button class="test-button" onclick="testTrackOrder()">Test Tracking</button>
                    <div class="test-results" id="track-order-results"></div>
                </div>
                <div class="test-card">
                    <h3>Get Orders</h3>
                    <button class="test-button" onclick="testGetOrders()">Test Get Orders</button>
                    <div class="test-results" id="get-orders-results"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üé® User Interface</div>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Notification System</h3>
                    <button class="test-button" onclick="testNotifications()">Test Notifications</button>
                    <button class="test-button danger" onclick="testErrorNotifications()">Test Errors</button>
                    <div class="test-results" id="notification-results"></div>
                </div>
                <div class="test-card">
                    <h3>Loading States</h3>
                    <button class="test-button" onclick="testLoadingStates()">Test Loading</button>
                    <div class="test-results" id="loading-results"></div>
                </div>
                <div class="test-card">
                    <h3>Form Validation</h3>
                    <button class="test-button" onclick="testFormValidation()">Test Validation</button>
                    <div class="test-results" id="validation-results"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üìä Performance & Error Handling</div>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Error Handling</h3>
                    <button class="test-button danger" onclick="testErrorHandling()">Test Errors</button>
                    <div class="test-results" id="error-handling-results"></div>
                </div>
                <div class="test-card">
                    <h3>Network Resilience</h3>
                    <button class="test-button warning" onclick="testNetworkResilience()">Test Network</button>
                    <div class="test-results" id="network-results"></div>
                </div>
                <div class="test-card">
                    <h3>Rate Limiting</h3>
                    <button class="test-button warning" onclick="testRateLimiting()">Test Rate Limit</button>
                    <div class="test-results" id="rate-limit-results"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üß™ Live Form Testing</div>
            <div class="form-test">
                <h3>Test Signup Form</h3>
                <form id="liveSignupForm">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" name="company" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select name="role" required>
                            <option value="">Select Role</option>
                            <option value="admin">Admin</option>
                            <option value="manager">Manager</option>
                            <option value="operator">Operator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" name="confirmPassword" required>
                    </div>
                    <button type="submit" class="test-button">Submit Live Test</button>
                </form>
                <div class="test-results" id="live-form-results"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="summary">
                <h3>üìà Test Summary</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="total-tests">0</div>
                        <div class="stat-label">Total Tests</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="passed-tests">0</div>
                        <div class="stat-label">Passed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="failed-tests">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="success-rate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
                <button class="test-button" onclick="runAllTests()" style="margin-top: 20px; width: 100%;">üöÄ Run All Tests</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="styles.js"></script>
    <script src="api.js"></script>
    <script src="auth.js"></script>

    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0
        };

        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'success' ? 'status-success' : 
                               type === 'error' ? 'status-error' : 
                               type === 'warning' ? 'status-warning' : 'status-info';
            
            element.innerHTML += `<div><span class="status-indicator ${statusClass}"></span>[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        function updateSummary() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
            const successRate = testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
        }

        function recordTest(passed) {
            testResults.total++;
            if (passed) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            updateSummary();
        }

        // Test Functions
        async function testEnvironment() {
            logResult('environment-results', 'Testing environment detection...', 'info');
            
            try {
                const config = window.YANGLOGISTICS_CONFIG;
                const isProduction = config.ENVIRONMENT === 'production';
                
                logResult('environment-results', `Environment: ${config.ENVIRONMENT}`, 'success');
                logResult('environment-results', `API URL: ${config.API_BASE_URL}`, 'success');
                logResult('environment-results', `Debug Mode: ${config.DEBUG}`, 'success');
                logResult('environment-results', `Version: ${config.VERSION}`, 'success');
                
                recordTest(true);
            } catch (error) {
                logResult('environment-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testAPIConfig() {
            logResult('api-config-results', 'Testing API configuration...', 'info');
            
            try {
                const api = window.api;
                logResult('api-config-results', `API Instance: ${api ? 'Loaded' : 'Not loaded'}`, api ? 'success' : 'error');
                logResult('api-config-results', `Base URL: ${api.baseURL}`, 'success');
                logResult('api-config-results', `Online Status: ${api.isOnline ? 'Online' : 'Offline'}`, 'success');
                logResult('api-config-results', `Authenticated: ${api.isAuthenticated() ? 'Yes' : 'No'}`, 'info');
                
                recordTest(!!api);
            } catch (error) {
                logResult('api-config-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testDatabase() {
            logResult('database-results', 'Testing database connection...', 'info');
            
            try {
                const response = await fetch(window.YANGLOGISTICS_CONFIG.API_BASE_URL + '/health');
                const data = await response.json();
                
                logResult('database-results', `Status: ${data.status}`, 'success');
                logResult('database-results', `Message: ${data.message}`, 'success');
                logResult('database-results', `Environment: ${data.environment}`, 'success');
                logResult('database-results', `Version: ${data.version}`, 'success');
                
                recordTest(data.status === 'OK');
            } catch (error) {
                logResult('database-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testHealthCheck() {
            logResult('health-results', 'Testing health check endpoint...', 'info');
            
            try {
                const response = await window.api.healthCheck();
                logResult('health-results', `Health Check: ${response.status}`, 'success');
                logResult('health-results', `Message: ${response.message}`, 'success');
                logResult('health-results', `Timestamp: ${response.timestamp}`, 'success');
                
                recordTest(response.status === 'OK');
            } catch (error) {
                logResult('health-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testSignup() {
            logResult('signup-results', 'Testing user signup...', 'info');
            
            try {
                const testData = {
                    firstName: 'Test',
                    lastName: 'User',
                    email: `test${Date.now()}@example.com`,
                    phone: '1234567890',
                    company: 'Test Company',
                    role: 'admin',
                    password: 'TestPassword123!',
                    confirmPassword: 'TestPassword123!'
                };
                
                const response = await window.api.signup(testData);
                logResult('signup-results', `Signup: ${response.success ? 'Success' : 'Failed'}`, response.success ? 'success' : 'error');
                logResult('signup-results', `Message: ${response.message}`, 'success');
                logResult('signup-results', `User ID: ${response.user?.id}`, 'success');
                
                recordTest(response.success);
            } catch (error) {
                logResult('signup-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testLogin() {
            logResult('login-results', 'Testing user login...', 'info');
            
            try {
                const credentials = {
                    email: 'admin@yanglogistics.com',
                    password: 'Admin123!'
                };
                
                const response = await window.api.login(credentials);
                logResult('login-results', `Login: ${response.success ? 'Success' : 'Failed'}`, response.success ? 'success' : 'error');
                logResult('login-results', `Message: ${response.message}`, 'success');
                logResult('login-results', `Token: ${response.token ? 'Present' : 'Missing'}`, response.token ? 'success' : 'warning');
                
                recordTest(response.success);
            } catch (error) {
                logResult('login-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testCreateOrder() {
            logResult('create-order-results', 'Testing order creation...', 'info');
            
            try {
                const orderData = {
                    customerName: 'Test Customer',
                    customerEmail: 'customer@example.com',
                    customerPhone: '1234567890',
                    pickupAddress: '123 Test St, Test City',
                    deliveryAddress: '456 Delivery Ave, Delivery City',
                    serviceType: 'Standard Delivery',
                    packageDetails: {
                        weight: 5,
                        description: 'Test Package',
                        quantity: 1
                    },
                    specialInstructions: 'Handle with care'
                };
                
                const response = await window.api.createOrder(orderData);
                logResult('create-order-results', `Order Creation: ${response.success ? 'Success' : 'Failed'}`, response.success ? 'success' : 'error');
                logResult('create-order-results', `Order ID: ${response.order?.id}`, 'success');
                logResult('create-order-results', `Tracking Number: ${response.order?.trackingNumber}`, 'success');
                
                recordTest(response.success);
            } catch (error) {
                logResult('create-order-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testTrackOrder() {
            logResult('track-order-results', 'Testing order tracking...', 'info');
            
            try {
                // First create an order to track
                const orderData = {
                    customerName: 'Track Test Customer',
                    customerEmail: 'track@example.com',
                    customerPhone: '1234567890',
                    pickupAddress: '123 Test St, Test City',
                    deliveryAddress: '456 Delivery Ave, Delivery City',
                    serviceType: 'Express Delivery',
                    packageDetails: {
                        weight: 3,
                        description: 'Track Test Package',
                        quantity: 1
                    }
                };
                
                const createResponse = await window.api.createOrder(orderData);
                if (createResponse.success) {
                    const trackingNumber = createResponse.order.trackingNumber;
                    const trackResponse = await window.api.trackOrder(trackingNumber);
                    
                    logResult('track-order-results', `Tracking: ${trackResponse.success ? 'Success' : 'Failed'}`, trackResponse.success ? 'success' : 'error');
                    logResult('track-order-results', `Found Order: ${trackResponse.order?.id}`, 'success');
                    logResult('track-order-results', `Status: ${trackResponse.order?.status}`, 'success');
                    
                    recordTest(trackResponse.success);
                } else {
                    logResult('track-order-results', 'Failed to create order for tracking test', 'error');
                    recordTest(false);
                }
            } catch (error) {
                logResult('track-order-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testGetOrders() {
            logResult('get-orders-results', 'Testing get orders...', 'info');
            
            try {
                const response = await window.api.getOrders();
                logResult('get-orders-results', `Get Orders: ${response.success ? 'Success' : 'Failed'}`, response.success ? 'success' : 'error');
                logResult('get-orders-results', `Total Orders: ${response.orders?.length || 0}`, 'success');
                logResult('get-orders-results', `Pagination: ${response.pagination ? 'Available' : 'Not available'}`, 'info');
                
                recordTest(response.success);
            } catch (error) {
                logResult('get-orders-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        function testNotifications() {
            logResult('notification-results', 'Testing notification system...', 'info');
            
            try {
                if (window.auth && window.auth.showNotification) {
                    window.auth.showNotification('Test success notification', 'success');
                    setTimeout(() => {
                        window.auth.showNotification('Test info notification', 'info');
                    }, 1000);
                    setTimeout(() => {
                        window.auth.showNotification('Test warning notification', 'warning');
                    }, 2000);
                    
                    logResult('notification-results', 'Success notifications displayed', 'success');
                    recordTest(true);
                } else {
                    logResult('notification-results', 'Notification system not available', 'error');
                    recordTest(false);
                }
            } catch (error) {
                logResult('notification-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        function testErrorNotifications() {
            logResult('notification-results', 'Testing error notifications...', 'info');
            
            try {
                if (window.auth && window.auth.showNotification) {
                    window.auth.showNotification('Test error notification', 'error');
                    logResult('notification-results', 'Error notification displayed', 'success');
                    recordTest(true);
                } else {
                    logResult('notification-results', 'Error notification system not available', 'error');
                    recordTest(false);
                }
            } catch (error) {
                logResult('notification-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        function testLoadingStates() {
            logResult('loading-results', 'Testing loading states...', 'info');
            
            try {
                if (window.auth && window.auth.showLoading && window.auth.hideLoading) {
                    window.auth.showLoading('Testing loading state...');
                    logResult('loading-results', 'Loading state displayed', 'success');
                    
                    setTimeout(() => {
                        window.auth.hideLoading();
                        logResult('loading-results', 'Loading state hidden', 'success');
                        recordTest(true);
                    }, 2000);
                } else {
                    logResult('loading-results', 'Loading state system not available', 'error');
                    recordTest(false);
                }
            } catch (error) {
                logResult('loading-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        function testFormValidation() {
            logResult('validation-results', 'Testing form validation...', 'info');
            
            try {
                if (window.auth && window.auth.validateSignupData) {
                    // Test invalid data
                    const invalidData = {
                        firstName: '',
                        lastName: 'Test',
                        email: 'invalid-email',
                        phone: '123',
                        company: '',
                        role: '',
                        password: '123',
                        confirmPassword: '456'
                    };
                    
                    const isValid = window.auth.validateSignupData(invalidData);
                    logResult('validation-results', `Invalid data rejected: ${!isValid}`, !isValid ? 'success' : 'error');
                    
                    // Test valid data
                    const validData = {
                        firstName: 'Test',
                        lastName: 'User',
                        email: 'test@example.com',
                        phone: '1234567890',
                        company: 'Test Company',
                        role: 'admin',
                        password: 'TestPassword123!',
                        confirmPassword: 'TestPassword123!'
                    };
                    
                    const isValid2 = window.auth.validateSignupData(validData);
                    logResult('validation-results', `Valid data accepted: ${isValid2}`, isValid2 ? 'success' : 'error');
                    
                    recordTest(!isValid && isValid2);
                } else {
                    logResult('validation-results', 'Form validation system not available', 'error');
                    recordTest(false);
                }
            } catch (error) {
                logResult('validation-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testErrorHandling() {
            logResult('error-handling-results', 'Testing error handling...', 'info');
            
            try {
                // Test invalid endpoint
                const response = await fetch(window.YANGLOGISTICS_CONFIG.API_BASE_URL + '/invalid-endpoint');
                const data = await response.json();
                
                logResult('error-handling-results', `Error Response: ${response.status}`, 'success');
                logResult('error-handling-results', `Error Type: ${data.error?.type}`, 'success');
                logResult('error-handling-results', `Error Message: ${data.error?.message}`, 'success');
                
                recordTest(response.status === 404);
            } catch (error) {
                logResult('error-handling-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testNetworkResilience() {
            logResult('network-results', 'Testing network resilience...', 'info');
            
            try {
                const api = window.api;
                logResult('network-results', `Online Status: ${api.isOnline ? 'Online' : 'Offline'}`, 'success');
                logResult('network-results', `Retry Attempts: ${api.config.API_RETRY_ATTEMPTS}`, 'success');
                logResult('network-results', `Timeout: ${api.config.API_TIMEOUT}ms`, 'success');
                
                recordTest(true);
            } catch (error) {
                logResult('network-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        async function testRateLimiting() {
            logResult('rate-limit-results', 'Testing rate limiting...', 'info');
            
            try {
                // Make multiple rapid requests
                const promises = [];
                for (let i = 0; i < 5; i++) {
                    promises.push(fetch(window.YANGLOGISTICS_CONFIG.API_BASE_URL + '/health'));
                }
                
                const responses = await Promise.all(promises);
                const successCount = responses.filter(r => r.status === 200).length;
                
                logResult('rate-limit-results', `Rapid requests made: 5`, 'success');
                logResult('rate-limit-results', `Successful responses: ${successCount}`, 'success');
                logResult('rate-limit-results', `Rate limiting: ${successCount < 5 ? 'Active' : 'Not active'}`, 'info');
                
                recordTest(true);
            } catch (error) {
                logResult('rate-limit-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        }

        // Live form testing
        document.getElementById('liveSignupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            logResult('live-form-results', 'Testing live form submission...', 'info');
            
            try {
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());
                
                logResult('live-form-results', `Form data collected: ${Object.keys(data).length} fields`, 'success');
                
                if (window.auth && window.auth.validateSignupData) {
                    const isValid = window.auth.validateSignupData(data);
                    logResult('live-form-results', `Validation: ${isValid ? 'Passed' : 'Failed'}`, isValid ? 'success' : 'error');
                    
                    if (isValid) {
                        const response = await window.api.signup(data);
                        logResult('live-form-results', `API Response: ${response.success ? 'Success' : 'Failed'}`, response.success ? 'success' : 'error');
                        logResult('live-form-results', `Message: ${response.message}`, 'success');
                    }
                }
                
                recordTest(true);
            } catch (error) {
                logResult('live-form-results', `Error: ${error.message}`, 'error');
                recordTest(false);
            }
        });

        async function runAllTests() {
            logResult('environment-results', 'Starting comprehensive test suite...', 'info');
            
            // Reset results
            testResults = { total: 0, passed: 0, failed: 0 };
            
            // Run all tests
            await testEnvironment();
            await testAPIConfig();
            await testDatabase();
            await testHealthCheck();
            await testSignup();
            await testLogin();
            await testCreateOrder();
            await testTrackOrder();
            await testGetOrders();
            testNotifications();
            testErrorNotifications();
            testLoadingStates();
            testFormValidation();
            await testErrorHandling();
            await testNetworkResilience();
            await testRateLimiting();
            
            logResult('environment-results', 'All tests completed!', 'success');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            logResult('environment-results', 'Professional test suite loaded', 'success');
            updateSummary();
        });
    </script>
</body>
</html>
