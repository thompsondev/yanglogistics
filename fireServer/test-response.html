<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Response Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>API Response Message Test</h1>
    
    <div class="test-section info">
        <h3>Test API Response Handling</h3>
        <p>This page tests how API responses are displayed to users.</p>
        <button onclick="testSignup()">Test Signup API</button>
        <button onclick="testLogin()">Test Login API</button>
        <button onclick="testHealth()">Test Health Check</button>
        <button onclick="testInvalidEndpoint()">Test Invalid Endpoint</button>
    </div>
    
    <div id="results"></div>
    
    <script src="config.js"></script>
    <script src="api.js"></script>
    
    <script>
        // Simulate the notification function from auth.js
        function showNotification(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            results.appendChild(div);
            console.log(`${type.toUpperCase()}: ${message}`);
        }
        
        // Test signup API
        async function testSignup() {
            console.log('üß™ Testing Signup API...');
            try {
                const testData = {
                    firstName: 'Test',
                    lastName: 'User',
                    email: 'test@example.com',
                    phone: '1234567890',
                    company: 'Test Company',
                    role: 'admin',
                    password: 'password123',
                    confirmPassword: 'password123'
                };
                
                const response = await api.signup(testData);
                console.log('Signup Response:', response);
                
                if (response && response.success) {
                    const successMessage = response.message || 'Account created successfully!';
                    showNotification(successMessage, 'success');
                } else {
                    const errorMessage = response?.message || response?.error?.message || 'Signup failed.';
                    showNotification(errorMessage, 'error');
                }
            } catch (error) {
                console.error('Signup Error:', error);
                let errorMessage = 'Signup failed. Please check your connection and try again.';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.response) {
                    try {
                        const errorData = JSON.parse(error.response);
                        errorMessage = errorData.message || errorData.error?.message || errorMessage;
                    } catch (e) {
                        errorMessage = `Server error: ${error.response}`;
                    }
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        // Test login API
        async function testLogin() {
            console.log('üß™ Testing Login API...');
            try {
                const testData = {
                    email: 'admin@yanglogistics.com',
                    password: 'admin123'
                };
                
                const response = await api.login(testData);
                console.log('Login Response:', response);
                
                if (response && response.success) {
                    const successMessage = response.message || 'Login successful!';
                    showNotification(successMessage, 'success');
                } else {
                    const errorMessage = response?.message || response?.error?.message || 'Login failed.';
                    showNotification(errorMessage, 'error');
                }
            } catch (error) {
                console.error('Login Error:', error);
                let errorMessage = 'Login failed. Please check your connection and try again.';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.response) {
                    try {
                        const errorData = JSON.parse(error.response);
                        errorMessage = errorData.message || errorData.error?.message || errorMessage;
                    } catch (e) {
                        errorMessage = `Server error: ${error.response}`;
                    }
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        // Test health check
        async function testHealth() {
            console.log('üß™ Testing Health Check...');
            try {
                const response = await api.healthCheck();
                console.log('Health Response:', response);
                showNotification(`Health check successful: ${response.message}`, 'success');
            } catch (error) {
                console.error('Health Check Error:', error);
                showNotification(`Health check failed: ${error.message}`, 'error');
            }
        }
        
        // Test invalid endpoint
        async function testInvalidEndpoint() {
            console.log('üß™ Testing Invalid Endpoint...');
            try {
                const response = await api.request('/invalid-endpoint');
                console.log('Invalid Endpoint Response:', response);
            } catch (error) {
                console.error('Invalid Endpoint Error:', error);
                let errorMessage = 'Request failed. Please check your connection and try again.';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.response) {
                    try {
                        const errorData = JSON.parse(error.response);
                        errorMessage = errorData.message || errorData.error?.message || errorMessage;
                    } catch (e) {
                        errorMessage = `Server error: ${error.response}`;
                    }
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        // Initialize
        console.log('üîç API Response Test Page Loaded');
        console.log('API Base URL:', window.API_BASE_URL);
        console.log('API Object:', typeof api !== 'undefined' ? api : 'Not loaded');
    </script>
</body>
</html>
